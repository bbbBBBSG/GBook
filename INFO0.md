## 第6章：小程序入门

## 6.1 认识小程序

- 6.1.1 小程序简介

微信小程序是腾讯于 2017 年 1 月 9 日推出的一种不需要下载安装即可在微信平台上使用的应用。引用一句张小龙的话：小程序是一种不需要下载安装即可使用的应用，它实现了应用「触手可及」的梦想，用户扫一扫或搜一下即可打开应用。也体现了「用完即走」的理念，用户不用关心是否安装太多应用的问题。应用将无处不在，随时可用，但又无需安装卸载。

我们可以在微信聊天列表中下拉，或者在 `发现` -> `小程序` 中都可以找到小程序。相对于原生 App 来说小程序的用户可便捷地获取服务，不用安装，即开即用，用完就走。省流量，省安装时间，不占用桌面；小程序还可以跨平台（同时支持 iOS 和 Android），降低开发成本，推广更容易更简单。

http://5b0988e595225.cdn.sohucs.com/images/20180120/814003d4d2ff4f499512f6b9362f8bd4.jpg

简单来说微信小程序就是在微信的平台上开发出的应用，用户只需要下载微信既可使用小程序。同时微信为微信小程序提供了一套基础组件库，可以满足开发的基础开发需求，从而实现简单的快速开发。

- 6.1.2 开发前的准备

1. 注册小程序开发者

首先我们需要注册一个微信小程序开发者账号，在微信公众平台(https://mp.weixin.qq.com)点击右上角的 `立即注册`，然后选择 `小程序` 填写相关信息即可，最后在 `信息登记` 部分需要注意本书推荐 `主体类型` 选择 `个人` 来进行学习。

2. 下载微信开发者工具

注册完微信小程序开发者后，我们需要登录小程序管理平台，在首页我们可以看到 `小程序发布流程`。我们需要根据提示先完善小程序信息，然后下载并安装微信开发者工具。

![小程序发布流程图][]

下载并安装好微信开发者工具后，的效果图如下：

![微信开发者工具效果图][]

- 6.1.3 Hello 小程序

接下来开始创建我们的第一个微信小程序项目，我们在开发者工具中选择 `小程序项目`，然后选择加号新建一个小程序项目，选择项目目录、填写 AppID、项目名称。

![创建小程序项目效果图][]

AppID 我们可以在 `小程序管理平台` 中的 `设置` -> `开发设置` 中找到。

![开发设置效果图][]

创建好项目之后就能看到开发工具的全貌了。

![开发工具项目效果图][]

- 6.1.4 代码构成

在上一章节中，我们使用开发者恐惧快速创建了一个项目，目录结构如下：

```json
|-ProjectName
	|-pages
		|-home
			|-home.js
			|-home.wxml
			|-home.wxss
	|-utils
		|-util.js
	|-app.js
	|-app.wxss
	|-app.json
	|-project.config.json
```

通过项目可以看到里面生成了不同的文件，总共有 4 中类型的文件。

1. `.json` 后缀的 `JSON` 配置文件
2. `.wxml` 后缀的 `WXML` 模板文件，可以理解为 HTML 文件
3. `.wxss` 后缀的 `WXSS` 样式文件，可以理解为 CSS 文件
4. `.js` 后缀的 `JS` 脚本逻辑文件

我们可以看到在项目的根目录有一个 `app.json` 和 `project.config.json`，此外在 `pages/home` 目录下还有一个 `home.json`。其中：

1. `app.json` 是当前小程序的全局配置，包括了小程序的所有页面路径、界面表现、网络超时时间、底部 tab 等。
2. `project.config.json` 是当前项目中对于开发工具的配置，你在工具上做的任何配置都会写入到这个文件。
3. `home.json` 是每个独立页面的配置，包括了页面的顶部颜色，是否允许下拉刷新等。

看过前面章节的读者应该知道，网页编程采用的是 HTML + CSS + JS 这样的组合，其中 HTML 是用来描述当前这个页面的结构，CSS 用来描述页面的样子，JS 通常是用来处理这个页面和用户的交互。

同样道理，在小程序中也有同样的角色，其中 `WXML` 充当的就是类似  `HTML` 的角色，和 `HTML` 非常相似，`WXML` 也是由标签、属性等等构成。但是 `WXML` 也有自己独特的特性，这些差异我们将在后面的章节详细介绍。

另外 `WXSS` 充当的是类似  `CSS` 的角色，`WXSS` 具有 `CSS` 大部分的特性，小程序在 `WXSS` 也做了一些扩充和修改。更详细的差别我们将在后面的部分为大家展示。

- 6.1.5 小程序的能力

小程序的特点：

1. 微信客户端在打开小程序之前，会把整个小程序的代码包下载到本地。
2. 小程序提供了丰富的基础组件给开发者，开发者可以像搭积木一样，组合各种组件拼合成自己的小程序。
3. 为了让开发者可以很方便的调起微信提供的能力，例如获取用户信息、微信支付等等，小程序提供了很多 API 给开发者去使用。
4. 服务端接口全部使用 HTTPS，确保传输中安全。
5. View 层和逻辑层分离，通过数据驱动，不直接操作 DOM。

小程序的不足：

1. 小程序仍然是使用 WebView 渲染，并非原生渲染。
2. 需要独立开发，不能在非微信环境运行。
3. 依赖浏览器环境的 js 库不能使用，因为是 JSCore 执行的，没有 window、document 对象。
4. WXSS 中无法使用本地图片、字体等。
5. WXSS 转化成 JS 而不是 CSS，为了兼容 rpx。
6. 小程序无法打开原生页面，无法拉起 App。

## 6.2 小程序框架

- 6.2.1 小程序配置
- 6.2.3 小程序生命周期
- 6.2.4 视图层
- 6.2.5 自定义组件

## 6.3 常用组件

- 6.3.1 视图容器
- 6.3.2 基础内容
- 6.3.3 表单组件
- 6.3.4 导航
- 6.3.5 媒体组件
- 6.3.6 地图
- 6.3.7 开放能力

## 6.4 常用 API

- 6.4.1 网络
1. 上传
2. 下载
3. 请求
- 6.4.2 媒体
1. 音频
2. 相机
3. 视频
- 6.4.3 文件
- 6.4.4 数据缓存
- 6.4.5 位置
- 6.4.6 设备
1. 网络
2. 电话
3. 扫码
- 6.4.7 开放接口
1. 授权
2. 支付
3. 小程序跳转
4. 设置
5. 数据分析
6. 用户信息
- 6.4.8 更新



## 要求标准

6.1 快速入门

小程序注册，给个网址让读者自己注册，然后说下注意实现，比如个人和企业的差别，是否能用微信支付

弄一个简易的demo，讲下项目结构、代码结构等，让大家有整体的感觉

6.2 常用的控件介绍，比如文本、button、图片、输入框、列表、动画等，每个控件介绍下常用属性，每个都一段代码 + 一张效果截图

6.3 进一步的例子，涉及到生命周期、WXSS样式与WXS模块、页面路由和模块，通过例子来讲这些东西

6.4 网络请求、存储等，都要通过例子来描述